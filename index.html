<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!--Import materialize.css-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ウイルスが発見されました</title>
</head>
<body class="red darken-3 white-text">
  <div class="container">
    <h1><img style="width: 20%; margin-right: 20px; vertical-align: middle;" src="virus.png" alt="">警告</h1>
    <h4>あなたの<span id="device"></span>からウイルスが発見されました</h4>
    <p class="flow-text">このままではスマートフォンが発火もしくは破裂する可能性があります。</p>
    <p class="flow-text"><span id="timer" style="font-size: 2em;"></span>秒以内に以下のリンクから対処してください。</p>
    <a href="https://amzn.asia/d/893PdJY" class="btn btn-laege">ウイルスを除去する</a>
  </div>
  <div id="alert" class="modal">
    <div class="modal-content black-text">
      <h4>警告</h4>
      <p>お使いの端末はウイスルからウイルスが発見されました。次のページからウイルスを除去してください。</p>
    </div>
    <div class="modal-footer">
      <button id="close" class="btn btn-laege">OK</button>
    </div>
  </div>
  <!--JavaScript at end of body for optimized loading-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
  <script>
    function play_se(){
      // SEとバイブレーションの制御
      var voice = new Audio('virus.mp3');
      voice.play();
      navigator.vibrate([200, 100, 200, 100, 200, 100, 200]);
    }

    $(function(){
      // ブラウザバック禁止
      history.pushState(null, null, null);
      $(window).on("popstate", function(e){
        if (!e.originalEvent.state){
          play_se();
          history.pushState(null, null, null);
          return;
        }
      });

      // モーダル初期化
      $('.modal').modal({dismissible: false});
      $('#alert').modal('open');
      $('#close').click(function(){
        $('#alert').modal('close');
        play_se();
      });

      var device = navigator.userAgent.match(/Android|iPhone|iPad/);
      if (device == null){
        device = '端末';
      }

      $('#device').text(device);
      var time = 300;
      setInterval(function(){
        time--;
        $('#timer').text(time);
      }, 1000);
      });
  </script>
  <!-- アクセス条件 -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAZ6NQ9gR_5r5LX_lnuV3AAahpJrrBZwzg",
      authDomain: "pest-a69d4.firebaseapp.com",
      projectId: "pest-a69d4",
      storageBucket: "pest-a69d4.appspot.com",
      messagingSenderId: "1073634294855",
      appId: "1:1073634294855:web:c2fdf25327abc64ded0562",
      measurementId: "G-WZS7H4KZ83"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // ログイン状態を監視
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "https://pest-religion.github.io/HP/login.html";
      }
    });

    // ログインから48時間以上経過していたら、ログインページにリダイレクト
    window.onload = () => {
      const lastLoginTime = localStorage.getItem('lastLoginTime');
      const currentTime = Date.now();
      if (!lastLoginTime || (currentTime - lastLoginTime >= 48 * 60 * 60 * 1000)) {
        window.location.href = "https://pest-religion.github.io/HP/login.html";
      }
    };
  </script>
</body>
</html>
